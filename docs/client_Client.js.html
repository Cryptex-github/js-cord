<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: client/Client.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: client/Client.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>//const { Log, NoLog } = require('../loggers');
const { sum } = require('../utils');
const { InvalidToken } = require('../errors/Errors');
const Intents = require('../models/Intents');
const SnowflakeSet = require('../models/SnowflakeSet');
const HTTPClient = require('../core/HTTPClient');
const Websocket = require('../core/Websocket');
const Emitter = require('./Emitter');
const Guild = require('../models/Guild');


module.exports = class Client extends Emitter {
    #apiVersion;
    #gatewayVersion;

    constructor({ 
        allowedMentions,
        intents = Intents.default(), 
        apiVersion = 9,
        gatewayVersion = 9 } = {}
    ) {
        super();

        // if (!logger instanceof Log) 
        //     throw new TypeError('Invalid type for option "logger"');

        this.cache = {
            guilds: new SnowflakeSet(),
            channels: new SnowflakeSet(),
            users: new SnowflakeSet(),
            messages: new SnowflakeSet(),
            emojis: new SnowflakeSet(),
            roles: new SnowflakeSet()
        }

        this._components = [];
        this.allowedMentions = allowedMentions;
        this.intents = intents;

        this.loggedIn = false;
        this.logger = { log: (..._) => {} };
        this.http = undefined;
        this.ws = undefined;
        this.user = undefined;

        this.#apiVersion = apiVersion;
        this.#gatewayVersion = gatewayVersion;
    }

    get id() {
        return this.user?.id;
    }

    get apiVersion() {
        return this.#apiVersion;
    }

    get gatewayVersion() {
        return this.#gatewayVersion;
    }

    get latency() {
        /**
         * Returns the bot's latency in milliseconds.
         */
        let latencies = this.ws.latencies;
        let lastThree = latencies.slice(-3);
        return (sum(lastThree) / lastThree.length) * 1000
    }

    #putToken(token) {
        if (!token) throw new InvalidToken('Token is undefined.');
        this.token = token;
    }

    #establishHTTP() {
        this.http = new HTTPClient(this, this.apiVersion);
    }

    #establishWebsocket() {
        this.ws = new Websocket(this, this.gatewayVersion);
    }

    /**
     * Starts the bot.
     * @async
     * @param {string} token The token to use to login into the gateway.
     */
    async start(token) {
        this.#putToken(token);
        this.#establishHTTP();
        this.#establishWebsocket();
        await this.ws.start();
    }

    login(token) {
        this.start(token).then();
    }

    /**
     * Tries to get a user from the internal cache.
     * @param {string} id The id of the user to find.
     * @returns {?User} The found user.
     */
    getUser(id) {
        return this.cache.users.get(id);
    }

    /**
     * Tries to get a channel from the internal cache.
     * @param {string} id The id of the guild to find.
     * @returns {?Guild} The found guild.
     */

    getGuild(id) {
        return this.cache.guilds.get(id);
    }

    /**
     * Tries to get a channel from the internal cache.
     * @param {string} id The id of the channel to find.
     * @returns {?Channel} The found channel.
     */
    getChannel(id) {
        return this.cache.channels.get(id);
    }

    /**
     * Tries to get a role from the internal cache.
     * @param {string} id The id of the role to find.
     * @returns {?Role} The found role.
     */
    getRole(id) {
        return this.cache.roles.get(id);
    }

    get users() {
        return [...this.cache.users.values()];
    }

    get channels() {
        return [...this.cache.channels.values()];
    }

    get guilds() {
        return [...this.cache.guilds.values()];
    }

    get roles() {
        return [...this.cache.roles.values()];
    }

    async fetchGuild(id) {
        const data = await this.http.getGuild(id);
        const guild = new Guild(this, data);
        this.cache.guilds.push(guild);
        return guild;
    }

    async createGuild(name) {
        const data = await this.http.createGuild(name);
        const guild = new Guild(this, data);
        this.cache.guilds.push(guild);
        return guild;
    }
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="BasicReverseStringView.html">BasicReverseStringView</a></li><li><a href="module.exports_module.exports.html">exports</a></li></ul><h3>Global</h3><ul><li><a href="global.html#sanitizeConverter">sanitizeConverter</a></li><li><a href="global.html#utils">utils</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.7</a> on Thu May 27 2021 20:34:12 GMT-0400 (Eastern Daylight Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
